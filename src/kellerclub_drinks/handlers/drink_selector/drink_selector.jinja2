{% extends 'layout_with_menu.jinja2' %}

{% block title %}Getr√§nke-Auswahl{% endblock %}

{% block css %}
<link rel="stylesheet" href="/drink_selector/drink_selector.css">
{% endblock %}
{% block js %}
{% set script = 'autosubmit' if autosubmit else 'manual_submit' %}
<script type="module" src="/drink_selector/{{ script }}.js" defer></script>
{% endblock %}

{% block main_content %}
{% set action = '/submit_order' if autosubmit else '/add_order' %}
<div id="drink-grid" data-autosubmit="{{ autosubmit | string | lower }}">
    <form class="main-form" method="POST" action="{{ action }}">
        <input class="hidden" name="event" value="{{ event_id }}">
        <ul class="selector-list">
            {% for row in layout.buttons %}
                {% for button in row %}
                    {% if button is none %}
                        <li></li>
                    {% elif button.is_order_button %}
                        <li><button type="submit" name="order" value="{{ button.drink_name }}">{{ button.display_name }}</button></li>
                    {% elif button.is_link %}
                        <li><a href="?layout={{ button.layout }}{{ '' if autosubmit else '&autosubmit=false' }}">
                            <i class="bi-folder"></i>{{ button.display_name }}
                        </a></li>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </ul>
    </form>
    <div class="sidebar">
        <form id="settings" method="POST" action="/drink_selector_settings">
            <input type="checkbox" name="autosubmit" id="autosubmit" {{ 'checked' if autosubmit else '' }}>
            <label for="autosubmit">Automatisch eintragen</label>
            <button type="submit" value="">Einstellungen speichern</button>
        </form>
        {% if not autosubmit %}
            <form method="POST" action="/submit_order?autosubmit=false">
                <div class="order-list">
                    <h1>Bestellungen</h1>
                    <input class="hidden" name="event" value="{{ event_id }}">
                    <ul>
                        {% for drink in stored_drinks %}
                        <li>
                            {{ drink.display_name }}
                            <input class="hidden" name="order" value="{{ drink.name }}"></li>
                        {% endfor %}
                    </ul>
                    <button>Eintragen</button>
                </div>
            </form>
        {% endif %}
    </div>
</div>
{% endblock %}
